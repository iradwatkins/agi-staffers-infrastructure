# Enterprise Caddyfile with Origin Configuration

# Origin endpoint for Cloudflare Workers (not proxied through Cloudflare)
origin.agistaffers.com {
    # Let's Encrypt will handle SSL since this domain is not proxied
    
    # Metrics API
    handle /api/metrics* {
        reverse_proxy localhost:3009 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }
    
    # Push API  
    handle /api/push* {
        reverse_proxy localhost:3011 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }
    
    # Admin Dashboard (default)
    handle {
        reverse_proxy localhost:8080 {
            header_up X-Real-IP {remote_host}
            header_up X-Forwarded-For {remote_host}
            header_up X-Forwarded-Proto {scheme}
        }
    }
    
    # Enterprise security headers
    header {
        X-Origin-Server "AGI-Staffers-Origin"
        Strict-Transport-Security "max-age=31536000; includeSubDomains; preload"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "DENY"
        X-XSS-Protection "1; mode=block"
        Referrer-Policy "strict-origin-when-cross-origin"
        Permissions-Policy "accelerometer=(), camera=(), geolocation=(), gyroscope=(), magnetometer=(), microphone=(), payment=(), usb=()"
    }
    
    # Rate limiting handled by Cloudflare Workers
}

# Main website
agistaffers.com {
    root * /var/www/agistaffers
    file_server
    
    header {
        Strict-Transport-Security "max-age=31536000; includeSubDomains"
        X-Content-Type-Options "nosniff"
        X-Frame-Options "SAMEORIGIN"
    }
}

# Admin Dashboard (proxied through Cloudflare)
admin.agistaffers.com {
    reverse_proxy localhost:8080
}

# Database Management
pgadmin.agistaffers.com {
    reverse_proxy localhost:5050
}

# Workflow Automation
n8n.agistaffers.com {
    reverse_proxy localhost:5678
}

# Container Management
portainer.agistaffers.com {
    reverse_proxy localhost:9000
}

# AI Chat Interface
chat.agistaffers.com {
    reverse_proxy localhost:3002
}

# AI Workflow Builder
flowise.agistaffers.com {
    reverse_proxy localhost:3001
}

# Search Engine
searxng.agistaffers.com {
    reverse_proxy localhost:8090
}

# Monitoring - Grafana
grafana.agistaffers.com {
    reverse_proxy localhost:3003
}

# Monitoring - Prometheus
prometheus.agistaffers.com {
    reverse_proxy localhost:9090
}

# Uptime Monitoring
uptime.agistaffers.com {
    reverse_proxy localhost:3004
}

# Object Storage
minio.agistaffers.com {
    reverse_proxy localhost:9001
}

# Secrets Management
vault.agistaffers.com {
    reverse_proxy localhost:8200
}

# Distributed Tracing
jaeger.agistaffers.com {
    reverse_proxy localhost:16686
}